# Instagram Clone - Architecture Documentation

This document provides detailed architectural information about the Instagram Clone microservices application.

## ğŸ—ï¸ System Architecture Overview

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    CLIENT LAYER                                 â”‚
â”‚                              (Web/Mobile Applications)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â”‚ HTTP/HTTPS Requests
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               API GATEWAY LAYER                                 â”‚
â”‚                              (Single Entry Point)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Authentication  â”‚  â”‚ Rate Limiting   â”‚  â”‚ Request Routing â”‚  â”‚ Caching     â”‚ â”‚
â”‚  â”‚ & Authorization â”‚  â”‚ & Throttling    â”‚  â”‚ & Load Balancingâ”‚  â”‚ & Storage   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚                   â”‚
                    â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    BUSINESS LAYER       â”‚ â”‚    BUSINESS LAYER       â”‚ â”‚    BUSINESS LAYER       â”‚
â”‚   (Microservices)       â”‚ â”‚   (Microservices)       â”‚ â”‚   (Microservices)       â”‚
â”‚                         â”‚ â”‚                         â”‚ â”‚                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   AUTH SERVICE      â”‚ â”‚ â”‚ â”‚   USER SERVICE       â”‚ â”‚ â”‚   POST SERVICE       â”‚ â”‚
â”‚ â”‚   (Port 3001)       â”‚ â”‚ â”‚ â”‚   (Port 3002)        â”‚ â”‚ â”‚   (Port 3003)        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                   â”‚                   â”‚
                    â”‚                   â”‚                   â”‚
                    â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MESSAGE QUEUE LAYER                                â”‚
â”‚                              (Event Processing)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ user_followed   â”‚  â”‚ post_created    â”‚  â”‚ notifications   â”‚  â”‚ dead_letter â”‚ â”‚
â”‚  â”‚     queue       â”‚  â”‚     queue       â”‚  â”‚     queue       â”‚  â”‚    queue    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NOTIFICATION SERVICE LAYER                               â”‚
â”‚                           (Event Handlers)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Event Handlers  â”‚  â”‚ Notification    â”‚  â”‚ Real-time       â”‚  â”‚ Database    â”‚ â”‚
â”‚  â”‚ & Processors    â”‚  â”‚ Creation        â”‚  â”‚ Delivery        â”‚  â”‚ Storage     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DATA LAYER                                         â”‚
â”‚                              (Persistence)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   PostgreSQL    â”‚  â”‚    MongoDB      â”‚  â”‚     Redis       â”‚  â”‚   MongoDB   â”‚ â”‚
â”‚  â”‚   (Users)       â”‚  â”‚   (Posts)       â”‚  â”‚   (Cache)       â”‚  â”‚(Notifications)â”‚ â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚             â”‚ â”‚
â”‚  â”‚ â€¢ User Profiles â”‚  â”‚ â€¢ Post Data     â”‚  â”‚ â€¢ Session Cache â”‚  â”‚ â€¢ Notificationsâ”‚ â”‚
â”‚  â”‚ â€¢ Followers     â”‚  â”‚ â€¢ Feed Data     â”‚  â”‚ â€¢ Rate Limiting â”‚  â”‚ â€¢ Event Logs â”‚ â”‚
â”‚  â”‚ â€¢ Relationships â”‚  â”‚ â€¢ Media URLs    â”‚  â”‚ â€¢ JWT Storage   â”‚  â”‚ â€¢ User Prefs â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Communication Patterns

### 1. Synchronous Communication (TCP)

Used for immediate request/response operations where the client needs an immediate result.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    TCP Request    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Gateway â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ User Serviceâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                â”‚
       â”‚    TCP Response               â”‚
       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                               â”‚
```

**Use Cases:**
- User authentication and login
- Post creation and retrieval
- Feed generation
- User profile updates
- Follower/following list retrieval

**Message Patterns:**
- `{ cmd: 'create_post' }`
- `{ cmd: 'get_feed_for_user' }`
- `{ cmd: 'get_user_followers' }`
- `{ cmd: 'follow_user' }`

### 2. Asynchronous Communication (RabbitMQ)

Used for event-driven operations where immediate response is not required.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Event: user_followed    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚User Service â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚Notification â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚   Service   â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Use Cases:**
- Follow/unfollow notifications
- Post creation notifications
- Background processing
- Event sourcing and replay

**Event Patterns:**
- `user_followed` - When a user follows another user
- `post_created` - When a new post is created

## ğŸ“Š Data Flow Examples

### 1. User Registration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Register Request    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Create User    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ API Gateway â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚Auth Service â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â–¼
       â”‚                                 â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                         â”‚ PostgreSQL  â”‚
       â”‚                                 â”‚                         â”‚  (Users)     â”‚
       â”‚                                 â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â–¼
       â”‚                                 â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                         â”‚   Redis     â”‚
       â”‚                                 â”‚                         â”‚ (Sessions)  â”‚
       â”‚                                 â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â–¼
       â”‚                                 â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                         â”‚ JWT Tokens  â”‚
       â”‚                                 â”‚                         â”‚ Generated   â”‚
       â”‚                                 â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â–¼
       â”‚                                 â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                         â”‚ API Gateway â”‚
       â”‚                                 â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â–¼
       â”‚                                 â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                         â”‚   Client    â”‚
       â”‚                                 â”‚                         â”‚ (Response)  â”‚
       â”‚                                 â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â”‚
       â”‚                                 â”‚                                 â–¼
       â”‚                                 â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                         â”‚   Client    â”‚
       â”‚                                 â”‚                         â”‚ (JWT Token) â”‚
       â”‚                                 â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Post Creation with Notifications Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Create Post    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    TCP Call    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ API Gateway â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚Post Service â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â–¼
       â”‚                               â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚                       â”‚   MongoDB   â”‚
       â”‚                               â”‚                       â”‚   (Posts)   â”‚
       â”‚                               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â–¼
       â”‚                               â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚                       â”‚Post Created â”‚
       â”‚                               â”‚                       â”‚   Event     â”‚
       â”‚                               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â–¼
       â”‚                               â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚                       â”‚  RabbitMQ   â”‚
       â”‚                               â”‚                       â”‚(post_created)â”‚
       â”‚                               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â–¼
       â”‚                               â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚                       â”‚Notification â”‚
       â”‚                               â”‚                       â”‚  Service    â”‚
       â”‚                               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â–¼
       â”‚                               â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚                       â”‚ Get User    â”‚
       â”‚                               â”‚                       â”‚ Followers   â”‚
       â”‚                               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â–¼
       â”‚                               â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚                       â”‚User Service â”‚
       â”‚                               â”‚                       â”‚(TCP Call)   â”‚
       â”‚                               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â–¼
       â”‚                               â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚                       â”‚ PostgreSQL  â”‚
       â”‚                               â”‚                       â”‚(Followers)  â”‚
       â”‚                               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â–¼
       â”‚                               â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚                       â”‚Create Notif.â”‚
       â”‚                               â”‚                       â”‚ for Each    â”‚
       â”‚                               â”‚                       â”‚ Follower    â”‚
       â”‚                               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â–¼
       â”‚                               â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚                       â”‚   MongoDB   â”‚
       â”‚                               â”‚                       â”‚(Notifications)â”‚
       â”‚                               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â–¼
       â”‚                               â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚                       â”‚Real-time    â”‚
       â”‚                               â”‚                       â”‚Notification â”‚
       â”‚                               â”‚                       â”‚ Delivery    â”‚
       â”‚                               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â”‚
       â”‚                               â”‚                              â–¼
       â”‚                               â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                               â”‚                       â”‚   Client    â”‚
       â”‚                               â”‚                       â”‚(Post Data)  â”‚
       â”‚                               â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Follow User Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Follow Request   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    TCP Call    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ API Gateway â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚User Service â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â–¼
       â”‚                                 â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                       â”‚ PostgreSQL  â”‚
       â”‚                                 â”‚                       â”‚(User Rel.)  â”‚
       â”‚                                 â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â–¼
       â”‚                                 â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                       â”‚Follow Event â”‚
       â”‚                                 â”‚                       â”‚ Generated   â”‚
       â”‚                                 â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â–¼
       â”‚                                 â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                       â”‚  RabbitMQ   â”‚
       â”‚                                 â”‚                       â”‚(user_followed)â”‚
       â”‚                                 â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â–¼
       â”‚                                 â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                       â”‚Notification â”‚
       â”‚                                 â”‚                       â”‚  Service    â”‚
       â”‚                                 â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â–¼
       â”‚                                 â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                       â”‚Create Followâ”‚
       â”‚                                 â”‚                       â”‚ Notificationâ”‚
       â”‚                                 â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â–¼
       â”‚                                 â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                       â”‚   MongoDB   â”‚
       â”‚                                 â”‚                       â”‚(Notifications)â”‚
       â”‚                                 â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â–¼
       â”‚                                 â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                       â”‚Real-time    â”‚
       â”‚                                 â”‚                       â”‚Notification â”‚
       â”‚                                 â”‚                       â”‚ Delivery    â”‚
       â”‚                                 â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â”‚
       â”‚                                 â”‚                              â–¼
       â”‚                                 â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                 â”‚                       â”‚   Client    â”‚
       â”‚                                 â”‚                       â”‚(Success)    â”‚
       â”‚                                 â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ Database Schema

### PostgreSQL (Users Database)

#### Users Table
```sql
CREATE TABLE "user" (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    username VARCHAR(100) UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### User Followers Table
```sql
CREATE TABLE user_follower (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    follower_id UUID REFERENCES "user"(id) ON DELETE CASCADE,
    followed_id UUID REFERENCES "user"(id) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(follower_id, followed_id)
);
```

### MongoDB (Posts Database)

#### Posts Collection
```javascript
{
  _id: ObjectId,
  userId: String,
  caption: String,
  mediaUrl: String,
  createdAt: Date,
  updatedAt: Date,
  __v: Number
}
```

### MongoDB (Notifications Database)

#### Notifications Collection
```javascript
{
  _id: ObjectId,
  userId: String,
  type: String, // 'follow' | 'post_created'
  message: String,
  data: {
    followerId: String, // for follow notifications
    postId: String,     // for post notifications
    authorId: String,   // for post notifications
    caption: String,    // for post notifications
    mediaUrl: String    // for post notifications
  },
  read: Boolean,
  createdAt: Date,
  updatedAt: Date,
  __v: Number
}
```

## ğŸ”§ Service Dependencies

### API Gateway Dependencies
- **Auth Service**: User authentication and token validation
- **User Service**: User management operations
- **Post Service**: Post creation and retrieval
- **Notification Service**: Notification management

### Auth Service Dependencies
- **PostgreSQL**: User data storage
- **Redis**: Session management and token storage

### User Service Dependencies
- **PostgreSQL**: User profiles and relationships
- **Notification Service**: Event emission for follow/unfollow

### Post Service Dependencies
- **MongoDB**: Post data storage
- **User Service**: Follower list retrieval for feed generation
- **Notification Service**: Event emission for post creation

### Notification Service Dependencies
- **MongoDB**: Notification storage
- **User Service**: Follower list retrieval
- **RabbitMQ**: Event consumption

## ğŸš€ Scalability Considerations

### Horizontal Scaling
- Each microservice can be scaled independently
- Load balancers can distribute traffic across multiple instances
- Database read replicas for read-heavy operations

### Vertical Scaling
- Increase container resources (CPU, Memory)
- Optimize database queries and indexes
- Implement caching strategies

### Performance Optimizations
- Redis caching for frequently accessed data
- Database connection pooling
- Asynchronous processing for non-critical operations
- CDN for static assets

## ğŸ”’ Security Considerations

### Authentication & Authorization
- JWT tokens with short expiration times
- Refresh token rotation
- Role-based access control (RBAC)
- API rate limiting

### Data Protection
- Password hashing with bcrypt
- Input validation and sanitization
- SQL injection prevention
- XSS protection

### Network Security
- HTTPS/TLS encryption
- Service-to-service authentication
- Network segmentation
- Firewall rules

## ğŸ“Š Monitoring & Observability

### Logging
- Structured logging with correlation IDs
- Centralized log aggregation
- Log level management
- Error tracking and alerting

### Metrics
- Service health checks
- Response time monitoring
- Error rate tracking
- Resource utilization metrics

### Tracing
- Distributed tracing across services
- Request flow visualization
- Performance bottleneck identification
- Dependency mapping

---

This architecture documentation provides a comprehensive overview of the Instagram Clone microservices application. For implementation details, refer to the individual service documentation and the main README.md file. 